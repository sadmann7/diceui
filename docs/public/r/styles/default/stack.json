{
  "name": "stack",
  "type": "registry:ui",
  "dependencies": [
    "@radix-ui/react-slot"
  ],
  "files": [
    {
      "path": "ui/stack.tsx",
      "content": "\"use client\";\r\n\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport * as React from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface ItemHeight {\r\n  itemId: number;\r\n  height: number;\r\n}\r\n\r\ninterface StackContextValue {\r\n  visibleItems: number;\r\n  gap: number;\r\n  scaleFactor: number;\r\n  expandOnHover: boolean;\r\n  offset: number;\r\n  isExpanded: boolean;\r\n  totalItems: number;\r\n  heights: ItemHeight[];\r\n  setHeights: React.Dispatch<React.SetStateAction<ItemHeight[]>>;\r\n}\r\n\r\nconst StackContext = React.createContext<StackContextValue | null>(null);\r\n\r\nfunction useStackContext() {\r\n  const context = React.useContext(StackContext);\r\n  if (!context) {\r\n    throw new Error(\"Stack components must be used within Stack.Root\");\r\n  }\r\n  return context;\r\n}\r\n\r\ninterface StackRootProps extends React.ComponentProps<\"div\"> {\r\n  visibleItems?: number;\r\n  gap?: number;\r\n  scaleFactor?: number;\r\n  expandOnHover?: boolean;\r\n  offset?: number;\r\n  asChild?: boolean;\r\n}\r\n\r\nfunction StackRoot(props: StackRootProps) {\r\n  const {\r\n    visibleItems = 3,\r\n    gap = 8,\r\n    scaleFactor = 0.05,\r\n    expandOnHover = true,\r\n    offset = 10,\r\n    asChild,\r\n    className,\r\n    children,\r\n    style,\r\n    onMouseEnter,\r\n    onMouseLeave,\r\n    ...rootProps\r\n  } = props;\r\n\r\n  const [isExpanded, setIsExpanded] = React.useState(false);\r\n  const [heights, setHeights] = React.useState<ItemHeight[]>([]);\r\n\r\n  const childrenArray = React.Children.toArray(children).filter(\r\n    React.isValidElement,\r\n  );\r\n  const totalItems = childrenArray.length;\r\n\r\n  const RootPrimitive = asChild ? Slot : \"div\";\r\n\r\n  const contextValue = React.useMemo<StackContextValue>(\r\n    () => ({\r\n      visibleItems,\r\n      gap,\r\n      scaleFactor,\r\n      expandOnHover,\r\n      offset,\r\n      isExpanded,\r\n      totalItems,\r\n      heights,\r\n      setHeights,\r\n    }),\r\n    [\r\n      visibleItems,\r\n      gap,\r\n      scaleFactor,\r\n      expandOnHover,\r\n      offset,\r\n      isExpanded,\r\n      totalItems,\r\n      heights,\r\n    ],\r\n  );\r\n\r\n  const onMouseEnterHandler = React.useCallback(\r\n    (event: React.MouseEvent<HTMLDivElement>) => {\r\n      onMouseEnter?.(event);\r\n      if (event.defaultPrevented) return;\r\n\r\n      if (expandOnHover) {\r\n        setIsExpanded(true);\r\n      }\r\n    },\r\n    [expandOnHover, onMouseEnter],\r\n  );\r\n\r\n  const onMouseLeaveHandler = React.useCallback(\r\n    (event: React.MouseEvent<HTMLDivElement>) => {\r\n      onMouseLeave?.(event);\r\n      if (event.defaultPrevented) return;\r\n\r\n      if (expandOnHover) {\r\n        setIsExpanded(false);\r\n      }\r\n    },\r\n    [expandOnHover, onMouseLeave],\r\n  );\r\n\r\n  return (\r\n    <StackContext.Provider value={contextValue}>\r\n      <RootPrimitive\r\n        data-slot=\"stack\"\r\n        data-expanded={isExpanded}\r\n        onMouseEnter={onMouseEnterHandler}\r\n        onMouseLeave={onMouseLeaveHandler}\r\n        {...rootProps}\r\n        className={cn(\"relative\", className)}\r\n        style={\r\n          {\r\n            \"--stack-gap\": `${gap}px`,\r\n            \"--stack-offset\": `${offset}px`,\r\n            \"--stack-scale-factor\": scaleFactor,\r\n            ...style,\r\n          } as React.CSSProperties\r\n        }\r\n      >\r\n        {childrenArray.map((child, index) => (\r\n          <StackItemWrapper key={index} index={index}>\r\n            {child}\r\n          </StackItemWrapper>\r\n        ))}\r\n      </RootPrimitive>\r\n    </StackContext.Provider>\r\n  );\r\n}\r\n\r\ninterface StackItemWrapperProps extends React.ComponentProps<\"div\"> {\r\n  index: number;\r\n}\r\n\r\nfunction StackItemWrapper(props: StackItemWrapperProps) {\r\n  const { children, index, style, ...itemProps } = props;\r\n\r\n  const {\r\n    visibleItems,\r\n    gap,\r\n    scaleFactor,\r\n    offset,\r\n    isExpanded,\r\n    totalItems,\r\n    heights,\r\n    setHeights,\r\n  } = useStackContext();\r\n\r\n  const itemRef = React.useRef<HTMLDivElement>(null);\r\n\r\n  const isFront = index === 0;\r\n  const isVisible = index < visibleItems;\r\n  const itemsBefore = index;\r\n\r\n  React.useEffect(() => {\r\n    const itemNode = itemRef.current;\r\n    if (itemNode) {\r\n      const height = itemNode.getBoundingClientRect().height;\r\n      setHeights((h) => {\r\n        const existing = h.find((item) => item.itemId === index);\r\n        if (!existing) {\r\n          return [...h, { itemId: index, height }];\r\n        }\r\n        return h.map((item) =>\r\n          item.itemId === index ? { ...item, height } : item,\r\n        );\r\n      });\r\n    }\r\n  }, [index, setHeights]);\r\n\r\n  const itemsHeightBefore = React.useMemo(() => {\r\n    return heights.reduce((prev, curr) => {\r\n      if (curr.itemId >= index) return prev;\r\n      return prev + curr.height;\r\n    }, 0);\r\n  }, [heights, index]);\r\n\r\n  const scale = isExpanded ? 1 : 1 - itemsBefore * scaleFactor;\r\n  const translateY = isExpanded\r\n    ? itemsBefore * gap + itemsHeightBefore\r\n    : itemsBefore * offset;\r\n  const zIndex = totalItems - index;\r\n\r\n  const opacity = isExpanded ? 1 : isVisible ? 1 - itemsBefore * 0.15 : 0;\r\n\r\n  return (\r\n    <div\r\n      ref={itemRef}\r\n      data-slot=\"stack-item-wrapper\"\r\n      data-index={index}\r\n      data-front={isFront}\r\n      data-visible={isVisible}\r\n      className={cn(\r\n        \"absolute top-0 left-0 w-full transition-all duration-300 ease-out\",\r\n        !isVisible && \"pointer-events-none\",\r\n      )}\r\n      style={{\r\n        transform: `translateY(${translateY}px) scale(${scale})`,\r\n        transformOrigin: \"top center\",\r\n        zIndex,\r\n        opacity,\r\n        ...style,\r\n      }}\r\n      {...itemProps}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface StackItemProps extends React.ComponentProps<\"div\"> {\r\n  asChild?: boolean;\r\n}\r\n\r\nfunction StackItem(props: StackItemProps) {\r\n  const { asChild, className, ...itemProps } = props;\r\n\r\n  const ItemPrimitive = asChild ? Slot : \"div\";\r\n\r\n  return (\r\n    <ItemPrimitive\r\n      data-slot=\"stack-item\"\r\n      {...itemProps}\r\n      className={cn(\r\n        \"rounded-lg border bg-card p-4 shadow-md\",\r\n        \"transition-shadow duration-200\",\r\n        \"hover:shadow-lg\",\r\n        className,\r\n      )}\r\n    />\r\n  );\r\n}\r\n\r\nexport {\r\n  StackRoot as Root,\r\n  StackItem as Item,\r\n  //\r\n  StackRoot as Stack,\r\n  StackItem,\r\n};\r\n",
      "type": "registry:ui",
      "target": ""
    }
  ]
}