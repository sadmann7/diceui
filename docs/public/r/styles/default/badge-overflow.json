{
  "name": "badge-overflow",
  "type": "registry:ui",
  "dependencies": [
    "@radix-ui/react-slot"
  ],
  "files": [
    {
      "path": "ui/badge-overflow.tsx",
      "content": "\"use client\";\n\nimport { Slot } from \"@radix-ui/react-slot\";\nimport * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nconst badgeWidthCache = new Map<string, number>();\n\nconst DEFAULT_CONTAINER_PADDING = 16; // px-2 = 8px * 2\nconst DEFAULT_BADGE_GAP = 4; // gap-1 = 4px\nconst DEFAULT_OVERFLOW_BADGE_WIDTH = 40; // Approximate width of \"+N\" badge\n\ninterface MeasureBadgeWidthProps {\n  label: string;\n  cacheKey: string;\n  iconSize?: number;\n  maxWidth?: number;\n  className?: string;\n}\n\nfunction measureBadgeWidth({\n  label,\n  cacheKey,\n  iconSize,\n  maxWidth,\n  className,\n}: MeasureBadgeWidthProps): number {\n  const cached = badgeWidthCache.get(cacheKey);\n  if (cached !== undefined) {\n    return cached;\n  }\n\n  const measureEl = document.createElement(\"div\");\n  measureEl.className = `inline-flex items-center rounded-md border px-1.5 text-xs font-semibold h-5 gap-1 shrink-0 absolute invisible pointer-events-none ${\n    className ?? \"\"\n  }`;\n  measureEl.style.whiteSpace = \"nowrap\";\n\n  if (iconSize) {\n    const icon = document.createElement(\"span\");\n    icon.className = \"shrink-0\";\n    icon.style.width = `${iconSize}px`;\n    icon.style.height = `${iconSize}px`;\n    measureEl.appendChild(icon);\n  }\n\n  if (maxWidth) {\n    const text = document.createElement(\"span\");\n    text.className = \"truncate\";\n    text.style.maxWidth = `${maxWidth}px`;\n    text.textContent = label;\n    measureEl.appendChild(text);\n  } else {\n    measureEl.textContent = label;\n  }\n\n  document.body.appendChild(measureEl);\n  const width = measureEl.offsetWidth;\n  document.body.removeChild(measureEl);\n\n  badgeWidthCache.set(cacheKey, width);\n  return width;\n}\n\nfunction clearBadgeWidthCache(): void {\n  badgeWidthCache.clear();\n}\n\ninterface GetBadgeLabel<T> {\n  /**\n   * Callback that returns a label string for each badge item.\n   * Optional for primitive arrays (strings, numbers), required for object arrays.\n   * @example getBadgeLabel={(item) => item.name}\n   */\n  getBadgeLabel: (item: T) => string;\n}\n\ntype BadgeOverflowProps<T = string> = React.ComponentProps<\"div\"> &\n  (T extends object ? GetBadgeLabel<T> : Partial<GetBadgeLabel<T>>) & {\n    items: T[];\n    lineCount?: number;\n    cacheKeyPrefix?: string;\n    iconSize?: number;\n    maxWidth?: number;\n    containerPadding?: number;\n    badgeGap?: number;\n    overflowBadgeWidth?: number;\n    renderBadge: (item: T, label: string) => React.ReactNode;\n    renderOverflow?: (count: number) => React.ReactNode;\n    asChild?: boolean;\n  };\n\nfunction BadgeOverflow<T = string>(props: BadgeOverflowProps<T>) {\n  const {\n    items,\n    getBadgeLabel: getBadgeLabelProp,\n    lineCount = 1,\n    cacheKeyPrefix = \"\",\n    containerPadding = DEFAULT_CONTAINER_PADDING,\n    badgeGap = DEFAULT_BADGE_GAP,\n    overflowBadgeWidth = DEFAULT_OVERFLOW_BADGE_WIDTH,\n    iconSize,\n    maxWidth,\n    renderBadge,\n    renderOverflow,\n    asChild,\n    className,\n    style,\n    ...rootProps\n  } = props;\n\n  const getBadgeLabel = React.useCallback(\n    (item: T): string => {\n      if (typeof item === \"object\" && !getBadgeLabelProp) {\n        throw new Error(\n          \"`getBadgeLabel` is required when using array of objects\",\n        );\n      }\n      return getBadgeLabelProp ? getBadgeLabelProp(item) : (item as string);\n    },\n    [getBadgeLabelProp],\n  );\n\n  const rootRef = React.useRef<HTMLDivElement | null>(null);\n  const [containerWidth, setContainerWidth] = React.useState(0);\n\n  React.useEffect(() => {\n    if (!rootRef.current) return;\n\n    function measureWidth() {\n      if (rootRef.current) {\n        const width = rootRef.current.clientWidth - containerPadding;\n        setContainerWidth(width);\n      }\n    }\n\n    measureWidth();\n\n    const resizeObserver = new ResizeObserver(measureWidth);\n    resizeObserver.observe(rootRef.current);\n\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, [containerPadding]);\n\n  const result = React.useMemo(() => {\n    if (!containerWidth || items.length === 0) {\n      return { visibleItems: items, hiddenCount: 0 };\n    }\n\n    let currentLineWidth = 0;\n    let currentLine = 1;\n    const visible: T[] = [];\n\n    for (const item of items) {\n      const label = getBadgeLabel(item);\n      const cacheKey = cacheKeyPrefix ? `${cacheKeyPrefix}:${label}` : label;\n\n      const badgeWidth = measureBadgeWidth({\n        label,\n        cacheKey,\n        iconSize,\n        maxWidth,\n        className,\n      });\n\n      const widthWithGap = badgeWidth + badgeGap;\n\n      if (currentLineWidth + widthWithGap <= containerWidth) {\n        currentLineWidth += widthWithGap;\n        visible.push(item);\n      } else if (currentLine < lineCount) {\n        currentLine++;\n        currentLineWidth = widthWithGap;\n        visible.push(item);\n      } else {\n        if (\n          currentLineWidth + overflowBadgeWidth > containerWidth &&\n          visible.length > 0\n        ) {\n          visible.pop();\n        }\n        break;\n      }\n    }\n\n    return {\n      visibleItems: visible,\n      hiddenCount: Math.max(0, items.length - visible.length),\n    };\n  }, [\n    items,\n    getBadgeLabel,\n    containerWidth,\n    lineCount,\n    cacheKeyPrefix,\n    iconSize,\n    maxWidth,\n    className,\n    badgeGap,\n    overflowBadgeWidth,\n  ]);\n\n  const Comp = asChild ? Slot : \"div\";\n\n  return (\n    <Comp\n      data-slot=\"badge-overflow\"\n      {...rootProps}\n      ref={rootRef}\n      className={cn(\"flex flex-wrap\", className)}\n      style={{\n        gap: badgeGap,\n        ...style,\n      }}\n    >\n      {result.visibleItems.map((item, index) => (\n        <React.Fragment key={index}>\n          {renderBadge(item, getBadgeLabel(item))}\n        </React.Fragment>\n      ))}\n      {result.hiddenCount > 0 &&\n        (renderOverflow ? (\n          renderOverflow(result.hiddenCount)\n        ) : (\n          <div className=\"inline-flex h-5 shrink-0 items-center rounded-md border px-1.5 font-semibold text-xs\">\n            +{result.hiddenCount}\n          </div>\n        ))}\n    </Comp>\n  );\n}\n\nexport {\n  BadgeOverflow,\n  //\n  clearBadgeWidthCache,\n};\n",
      "type": "registry:ui",
      "target": ""
    }
  ]
}